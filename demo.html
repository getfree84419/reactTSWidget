<!DOCTYPE html>
<html lang="zh-TW">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Widget å®Œæ•´æ¼”ç¤º - CoffeeScript</title>

    <!-- Widget æ¨£å¼ -->
    <link rel="stylesheet" href="./dist/widget/all-widgets.css" />

    <!-- React å’Œ ReactDOM (å¿…é ˆåœ¨ RequireJS ä¹‹å‰è¼‰å…¥) -->
    <script
      crossorigin
      src="https://unpkg.com/react@18/umd/react.production.min.js"
    ></script>
    <script
      crossorigin
      src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"
    ></script>

    <!-- Widget (å¿…é ˆåœ¨ RequireJS ä¹‹å‰è¼‰å…¥ï¼Œä½¿ç”¨å…¨å±€è®Šé‡æ¨¡å¼) -->
    <script>
      // è‡¨æ™‚ç¦ç”¨ defineï¼Œé¿å… RequireJS è¡çª
      var originalDefine = window.define;
      window.define = undefined;
    </script>
    <script src="./dist/widget/all-widgets.umd.js"></script>
    <script>
      // æ¢å¾© define
      window.define = originalDefine;
    </script>

    <!-- RequireJS (åœ¨ Widget ä¹‹å¾Œè¼‰å…¥) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js"></script>

    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Roboto",
          "Oxygen", "Ubuntu", "Cantarell", "Fira Sans", "Droid Sans",
          "Helvetica Neue", sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 20px;
      }

      .container {
        max-width: 1400px;
        margin: 0 auto;
      }

      .header {
        text-align: center;
        color: white;
        margin-bottom: 30px;
      }

      .header h1 {
        font-size: 36px;
        margin-bottom: 10px;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
      }

      .header p {
        font-size: 18px;
        opacity: 0.9;
      }

      .widgets-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
        gap: 30px;
        margin-bottom: 30px;
      }

      .widget-section {
        background: white;
        border-radius: 16px;
        padding: 30px;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
        transition: transform 0.3s ease, box-shadow 0.3s ease;
      }

      .widget-section:hover {
        transform: translateY(-5px);
        box-shadow: 0 15px 50px rgba(0, 0, 0, 0.3);
      }

      .widget-section h2 {
        color: #333;
        font-size: 24px;
        margin-bottom: 20px;
        padding-bottom: 15px;
        border-bottom: 3px solid #667eea;
      }

      .widget-section p {
        color: #666;
        margin-bottom: 20px;
        line-height: 1.6;
      }

      .controls {
        display: flex;
        gap: 10px;
        margin-bottom: 20px;
        flex-wrap: wrap;
      }

      .btn {
        padding: 10px 20px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-size: 14px;
        font-weight: 600;
        transition: all 0.2s ease;
        background: #667eea;
        color: white;
      }

      .btn:hover {
        background: #5568d3;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
      }

      .btn:active {
        transform: translateY(0);
      }

      .btn-secondary {
        background: #6b7280;
      }

      .btn-secondary:hover {
        background: #4b5563;
      }

      .btn-success {
        background: #10b981;
      }

      .btn-success:hover {
        background: #059669;
      }

      .widget-container {
        min-height: 400px;
        position: relative;
      }

      .info-box {
        background: #f0f9ff;
        border-left: 4px solid #3b82f6;
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 20px;
      }

      .info-box h3 {
        color: #1e40af;
        margin-bottom: 8px;
        font-size: 16px;
      }

      .info-box p {
        color: #1e3a8a;
        font-size: 14px;
        margin: 0;
      }

      .log-area {
        background: #1f2937;
        color: #10b981;
        padding: 15px;
        border-radius: 8px;
        font-family: "Courier New", monospace;
        font-size: 12px;
        max-height: 200px;
        overflow-y: auto;
        margin-top: 20px;
      }

      .log-area .log-entry {
        margin-bottom: 5px;
        padding: 5px;
        border-left: 2px solid #10b981;
        padding-left: 10px;
      }

      .log-area .log-time {
        color: #6b7280;
        margin-right: 10px;
      }

      @media (max-width: 768px) {
        .widgets-grid {
          grid-template-columns: 1fr;
        }

        .header h1 {
          font-size: 28px;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>ğŸ¯ Widget å®Œæ•´æ¼”ç¤º</h1>
        <p>ä½¿ç”¨ CoffeeScript ç®¡ç†æ‰€æœ‰ Widget</p>
      </div>

      <div class="widgets-grid">
        <!-- Widget 1: é¦–é è¨»å†Šè¡¨å–® -->
        <div class="widget-section">
          <h2>ğŸ“ é¦–é è¨»å†Šè¡¨å–®</h2>
          <p>é€™æ˜¯ä¸€å€‹è¨»å†Šè¡¨å–® widgetï¼Œç”¨æ–¼ç”¨æˆ¶è¨»å†Šã€‚</p>

          <div class="info-box">
            <h3>åŠŸèƒ½èªªæ˜</h3>
            <p>å¡«å¯«è¡¨å–®å¾Œï¼Œè¨»å†ŠæˆåŠŸæœƒè‡ªå‹•æ›´æ–°é¡¯ç¤º widget ä¸¦è¨˜éŒ„åˆ°æ—¥èªŒä¸­ã€‚</p>
          </div>

          <div class="controls">
            <button class="btn" id="show-home-widget">é¡¯ç¤º</button>
            <button class="btn btn-secondary" id="hide-home-widget">
              éš±è—
            </button>
          </div>

          <div id="home-registration-widget" class="widget-container"></div>
        </div>

        <!-- Widget 2: å´é‚Šæ¬„è¨»å†Šè¡¨å–® -->
        <div class="widget-section">
          <h2>ğŸ“‹ å´é‚Šæ¬„è¨»å†Šè¡¨å–®</h2>
          <p>å¦ä¸€å€‹è¨»å†Šè¡¨å–® widget å¯¦ä¾‹ã€‚</p>

          <div class="info-box">
            <h3>åŠŸèƒ½èªªæ˜</h3>
            <p>å¯ä»¥åŒæ™‚ä½¿ç”¨å¤šå€‹è¨»å†Šè¡¨å–® widgetï¼Œæ¯å€‹éƒ½æœ‰ç¨ç«‹çš„é…ç½®ã€‚</p>
          </div>

          <div class="controls">
            <button class="btn" id="show-sidebar-widget">é¡¯ç¤º</button>
            <button class="btn btn-secondary" id="hide-sidebar-widget">
              éš±è—
            </button>
          </div>

          <div id="sidebar-registration-widget" class="widget-container"></div>
        </div>

        <!-- Widget 3: é¡¯ç¤º Widget -->
        <div class="widget-section">
          <h2>ğŸ“Š è¨»å†Šè¨˜éŒ„é¡¯ç¤º</h2>
          <p>é¡¯ç¤ºæ‰€æœ‰è¨»å†Šè¨˜éŒ„çš„ widgetã€‚</p>

          <div class="info-box">
            <h3>åŠŸèƒ½èªªæ˜</h3>
            <p>ç•¶æœ‰æ–°çš„è¨»å†Šæ™‚ï¼Œæœƒè‡ªå‹•æ›´æ–°é¡¯ç¤ºã€‚ä¹Ÿå¯ä»¥æ‰‹å‹•é‡æ–°è¼‰å…¥æ•¸æ“šã€‚</p>
          </div>

          <div class="controls">
            <button class="btn btn-success" id="refresh-display">
              é‡æ–°è¼‰å…¥
            </button>
            <button class="btn" id="show-display-widget">é¡¯ç¤º</button>
            <button class="btn btn-secondary" id="hide-display-widget">
              éš±è—
            </button>
          </div>

          <div id="registration-display-widget" class="widget-container"></div>
        </div>

        <!-- Widget 4: æ—¥èªŒé¡¯ç¤º -->
        <div class="widget-section">
          <h2>ğŸ“œ æ“ä½œæ—¥èªŒ</h2>
          <p>æ‰€æœ‰ widget çš„æ“ä½œè¨˜éŒ„ã€‚</p>

          <div class="controls">
            <button class="btn btn-secondary" id="clear-log">æ¸…é™¤æ—¥èªŒ</button>
          </div>

          <div id="log-area" class="log-area">
            <div class="log-entry">
              <span class="log-time">[ç³»çµ±]</span>
              <span>ç­‰å¾…åˆå§‹åŒ–...</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- CoffeeScript ç·¨è­¯å¾Œçš„ JavaScript -->
    <script>
      // RequireJS é…ç½®
      require.config({
        paths: {
          jquery: "https://code.jquery.com/jquery-3.6.0.min",
        },
      });

      // ä¸»ç¨‹åºï¼ˆé€™è£¡æ˜¯ç·¨è­¯å¾Œçš„ CoffeeScriptï¼‰
      require(["jquery"], function ($) {
        $(document).ready(function () {
          // æ—¥èªŒå‡½æ•¸
          function addLog(message, type) {
            type = type || "info";
            var time = new Date().toLocaleTimeString("zh-TW");
            var logArea = $("#log-area");
            var logEntry = $('<div class="log-entry"></div>');
            logEntry.append('<span class="log-time">[' + time + "]</span>");
            logEntry.append("<span>" + message + "</span>");

            if (type === "success") {
              logEntry.css("border-left-color", "#10b981");
            } else if (type === "error") {
              logEntry.css("border-left-color", "#ef4444");
            } else if (type === "warning") {
              logEntry.css("border-left-color", "#f59e0b");
            }

            logArea.append(logEntry);
            logArea.scrollTop(logArea[0].scrollHeight);
          }

          // æª¢æŸ¥ Widget æ˜¯å¦è¼‰å…¥
          if (!window.WidgetManager) {
            addLog("éŒ¯èª¤: WidgetManager æœªè¼‰å…¥ï¼", "error");
            return;
          }

          addLog("WidgetManager å·²è¼‰å…¥ï¼Œé–‹å§‹åˆå§‹åŒ–...", "success");

          // åˆå§‹åŒ–é¦–é è¨»å†Šè¡¨å–®
          window.WidgetManager.initRegistrationWidget(
            "home",
            "home-registration-widget",
            {
              onSubmit: function (data) {
                addLog(
                  "é¦–é è¡¨å–®æäº¤: " + data.username + " (" + data.email + ")",
                  "info"
                );
              },
              onSuccess: function (data) {
                addLog(
                  "âœ“ é¦–é è¨»å†ŠæˆåŠŸ: " + data.username + " (" + data.email + ")",
                  "success"
                );

                // æ›´æ–°é¡¯ç¤º widget
                var displayData = {
                  username: data.username,
                  email: data.email,
                  phone: data.phone,
                  registeredAt: new Date().toISOString(),
                };
                window.WidgetManager.updateDisplayWidget(
                  "display",
                  displayData
                );
              },
            }
          );
          addLog("é¦–é è¨»å†Šè¡¨å–® widget å·²åˆå§‹åŒ–", "success");

          // åˆå§‹åŒ–å´é‚Šæ¬„è¨»å†Šè¡¨å–®
          window.WidgetManager.initRegistrationWidget(
            "sidebar",
            "sidebar-registration-widget",
            {
              onSubmit: function (data) {
                addLog(
                  "å´é‚Šæ¬„è¡¨å–®æäº¤: " + data.username + " (" + data.email + ")",
                  "info"
                );
              },
              onSuccess: function (data) {
                addLog(
                  "âœ“ å´é‚Šæ¬„è¨»å†ŠæˆåŠŸ: " +
                    data.username +
                    " (" +
                    data.email +
                    ")",
                  "success"
                );

                // æ›´æ–°é¡¯ç¤º widget
                var displayData = {
                  username: data.username,
                  email: data.email,
                  phone: data.phone,
                  registeredAt: new Date().toISOString(),
                };
                window.WidgetManager.updateDisplayWidget(
                  "display",
                  displayData
                );
              },
            }
          );
          addLog("å´é‚Šæ¬„è¨»å†Šè¡¨å–® widget å·²åˆå§‹åŒ–", "success");

          // åˆå§‹åŒ–é¡¯ç¤º widget
          window.WidgetManager.initDisplayWidget(
            "display",
            "registration-display-widget",
            {
              emptyMessage: "æš«ç„¡è¨»å†Šè¨˜éŒ„ï¼Œè«‹å¡«å¯«ä¸Šæ–¹è¡¨å–®é€²è¡Œè¨»å†Š",
              onRefresh: function () {
                addLog("é¡¯ç¤º widget é‡æ–°è¼‰å…¥æ•¸æ“š", "info");
                // é€™è£¡å¯ä»¥å¾å¾Œç«¯è¼‰å…¥æ•¸æ“š
                var mockData = [
                  {
                    username: "ç¤ºä¾‹ç”¨æˆ¶1",
                    email: "user1@example.com",
                    phone: "0912345678",
                    registeredAt: new Date(Date.now() - 86400000).toISOString(),
                  },
                  {
                    username: "ç¤ºä¾‹ç”¨æˆ¶2",
                    email: "user2@example.com",
                    phone: "0987654321",
                    registeredAt: new Date(
                      Date.now() - 172800000
                    ).toISOString(),
                  },
                ];
                window.WidgetManager.updateDisplayWidget("display", mockData);
                addLog("å·²è¼‰å…¥ " + mockData.length + " æ¢ç¤ºä¾‹æ•¸æ“š", "success");
              },
            }
          );
          addLog("é¡¯ç¤º widget å·²åˆå§‹åŒ–", "success");

          // æ§åˆ¶æŒ‰éˆ•äº‹ä»¶
          $("#show-home-widget").on("click", function () {
            window.WidgetManager.show("home", "registration");
            addLog("é¡¯ç¤ºé¦–é è¨»å†Šè¡¨å–®", "info");
          });

          $("#hide-home-widget").on("click", function () {
            window.WidgetManager.hide("home", "registration");
            addLog("éš±è—é¦–é è¨»å†Šè¡¨å–®", "info");
          });

          $("#show-sidebar-widget").on("click", function () {
            window.WidgetManager.show("sidebar", "registration");
            addLog("é¡¯ç¤ºå´é‚Šæ¬„è¨»å†Šè¡¨å–®", "info");
          });

          $("#hide-sidebar-widget").on("click", function () {
            window.WidgetManager.hide("sidebar", "registration");
            addLog("éš±è—å´é‚Šæ¬„è¨»å†Šè¡¨å–®", "info");
          });

          $("#show-display-widget").on("click", function () {
            window.WidgetManager.show("display", "display");
            addLog("é¡¯ç¤ºè¨»å†Šè¨˜éŒ„", "info");
          });

          $("#hide-display-widget").on("click", function () {
            window.WidgetManager.hide("display", "display");
            addLog("éš±è—è¨»å†Šè¨˜éŒ„", "info");
          });

          $("#refresh-display").on("click", function () {
            // è§¸ç™¼é¡¯ç¤º widget çš„é‡æ–°è¼‰å…¥
            if (window.RegistrationDisplayWidget) {
              // æ¨¡æ“¬è¼‰å…¥æ•¸æ“š
              var mockData = [
                {
                  username: "ç¤ºä¾‹ç”¨æˆ¶1",
                  email: "user1@example.com",
                  phone: "0912345678",
                  registeredAt: new Date(Date.now() - 86400000).toISOString(),
                },
                {
                  username: "ç¤ºä¾‹ç”¨æˆ¶2",
                  email: "user2@example.com",
                  phone: "0987654321",
                  registeredAt: new Date(Date.now() - 172800000).toISOString(),
                },
              ];
              window.WidgetManager.updateDisplayWidget("display", mockData);
              addLog("å·²è¼‰å…¥ " + mockData.length + " æ¢ç¤ºä¾‹æ•¸æ“š", "success");
            }
          });

          $("#clear-log").on("click", function () {
            $("#log-area").empty();
            addLog("æ—¥èªŒå·²æ¸…é™¤", "warning");
          });

          // é¡¯ç¤ºæ‰€æœ‰ widget ID
          setTimeout(function () {
            var allIds = window.WidgetManager.getWidgetIds();
            addLog("æ‰€æœ‰å·²è¨»å†Šçš„ Widget ID: " + allIds.join(", "), "info");
          }, 500);

          addLog("æ‰€æœ‰ widget åˆå§‹åŒ–å®Œæˆï¼", "success");
        });
      });
    </script>
  </body>
</html>
